<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>ACS Audio Jack iOS Library: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ACS Audio Jack iOS Library
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ACS Audio Jack iOS Library Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>This library provides classes and protocols for communicating with ACS audio jack readers on iOS 5.0 or above.</p>
<h1><a class="anchor" id="using"></a>
Using the library</h1>
<p>Your application should include a header file <code><a class="el" href="_audio_jack_8h.html">AudioJack.h</a></code> in order to use the classes and protocols provided by the library.</p>
<p>To use <code><a class="el" href="interface_a_c_r_audio_jack_reader.html" title="The ACRAudioJackReader class represents ACS audio jack readers. ">ACRAudioJackReader</a></code> class, you should assign a delegate to your reader. Your delegate object is responsibe for receiving the data from the reader and should conform to the <code><a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html" title="The ACRAudioJackReaderDelegate protocol defines the response sent to a delegate of ACRAudioJackReader...">ACRAudioJackReaderDelegate</a></code> protocol.</p>
<h2><a class="anchor" id="header"></a>
MyViewController.h</h2>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// MyViewController.h</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#import &lt;UIKit/UIKit.h&gt;</span></div>
<div class="line"><span class="preprocessor">#import &quot;<a class="code" href="_audio_jack_8h.html">AudioJack/AudioJack.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">@<span class="keyword">interface </span>MyViewController : UIViewController &lt;ACRAudioJackReaderDelegate&gt;</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="keyword">@end</span></div>
</div><!-- fragment --><h2><a class="anchor" id="source"></a>
MyViewController.m</h2>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// MyViewController.m</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#import &quot;MyViewController.h&quot;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">@implementation MyViewController {</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *_reader;</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)viewDidLoad</div>
<div class="line">{</div>
<div class="line">    [super viewDidLoad];</div>
<div class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize ACRAudioJackReader object.</span></div>
<div class="line">    _reader = [[<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> alloc] init];</div>
<div class="line">    [_reader setDelegate:<span class="keyword">self</span>];</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="reset"></a>
Resetting the reader</h2>
<p>The sleep mode of reader is enabled by default. To use the reader, your application should call <a class="el" href="interface_a_c_r_audio_jack_reader.html#a470414220e75255c7d831a4e80f7d368" title="Resets the reader. ">reset (ACRAudioJackReader)</a> method. If your delegate object implements <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ac37fd9a9f3704b6f95f60335f6048b49" title="Tells the delegate that the reader had been reset. ">readerDidReset: (ACRAudioJackReaderDelegate-p)</a> method, it will receive a notification after the operation is completed.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Reset the reader.</span></div>
<div class="line">[_reader reset];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)readerDidReset:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the notification.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="sleepmode"></a>
Controlling the sleep mode</h2>
<p>You can enable the sleep mode by calling <a class="el" href="interface_a_c_r_audio_jack_reader.html#aa1af8e85a03692c5ee7c153ae3d6b1a5" title="Sends a sleep request to the reader. ">sleep (ACRAudioJackReader)</a> method. If your delegate object implements <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ab8fe480d3dc5cf02861e979a9c3aed6e" title="Tells the delegate that the reader notified the result. ">reader:didNotifyResult: (ACRAudioJackReaderDelegate-p)</a> method, it will receive a notification after the operation is completed.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Enable the sleep mode.</span></div>
<div class="line">[_reader sleep];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader didNotifyResult:(<a class="code" href="interface_a_c_r_result.html">ACRResult</a> *)result {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the notification.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="sleeptimeout"></a>
Setting the sleep timeout</h2>
<p>You can set the sleep timeout by calling ACRAudioJackReader::setSleepTimeout method. If your delegate object implements <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ab8fe480d3dc5cf02861e979a9c3aed6e" title="Tells the delegate that the reader notified the result. ">reader:didNotifyResult: (ACRAudioJackReaderDelegate-p)</a> method, it will receive a notification after the operation is completed.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the sleep timeout to 10 seconds.</span></div>
<div class="line">[_reader setSleepTimeout:10];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader didNotifyResult:(<a class="code" href="interface_a_c_r_result.html">ACRResult</a> *)result {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the notification.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="firmware"></a>
Getting the firmware version</h2>
<p>To get the firmware version, your application should call <a class="el" href="interface_a_c_r_audio_jack_reader.html#a27852c460cd808939e9fbc5912525cdb" title="Sends a firmware version request to the reader. ">getFirmwareVersion (ACRAudioJackReader)</a> method. Your delegate object should implement <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ab85a081181a5b1aaf1c21b6d9d0d767c" title="Tells the delegate that the reader sent the firmware version. ">reader:didSendFirmwareVersion: (ACRAudioJackReaderDelegate-p)</a> method in order to receive the firmware version.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the firmware version.</span></div>
<div class="line">[_reader getFirmwareVersion];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader</div>
<div class="line">    didSendFirmwareVersion:(NSString *)firmwareVersion {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the firmware version.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="status"></a>
Getting the status</h2>
<p>To get the status, your application should call <a class="el" href="interface_a_c_r_audio_jack_reader.html#af32c613b5408ff9beea354eec3e3485d" title="Sends a status request to the reader. ">getStatus (ACRAudioJackReader)</a> method. Your delegate object should implement <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#a365903a1e25b15c68ccca9fd09f77f66" title="Tells the delegate that the reader sent the status. ">reader:didSendStatus: (ACRAudioJackReaderDelegate-p)</a> method in order to receive the status.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the status.</span></div>
<div class="line">[_reader getStatus];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader didSendStatus:(<a class="code" href="interface_a_c_r_status.html">ACRStatus</a> *)status {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the status.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="track"></a>
Receiving the track data</h2>
<p>When you swipe a card, the reader sends a track data through an audio channel to your iOS device. Your delegate object should implement <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ae92481cba41cc22f9218f26afbc0aa89" title="Tells the delegate that the reader sent the track data. ">reader:didSendTrackData: (ACRAudioJackReaderDelegate-p)</a> method in order to receive the track data. You can check the track error using <a class="el" href="interface_a_c_r_track_data.html#aa68bdf20940a65a189c6ec68f9a33777" title="Track 1 error code. ">ACRTrackData::track1ErrorCode</a> and <a class="el" href="interface_a_c_r_track_data.html#a3352d4f9e55047cae89611f28932a312" title="Track 2 error code. ">ACRTrackData::track2ErrorCode</a> properties. Note that the received <a class="el" href="interface_a_c_r_track_data.html" title="The ACRTrackData class represents the track data after swiping a card from the reader. ">ACRTrackData</a> object will be the instance of <a class="el" href="interface_a_c_r_aes_track_data.html" title="The ACRAesTrackData class represents the track data after swiping a card from the reader using AES mo...">ACRAesTrackData</a> or <a class="el" href="interface_a_c_r_dukpt_track_data.html" title="The ACRDukptTrackData class represents the track data after swiping a card from the reader using DUKP...">ACRDukptTrackData</a> according to the settings. You must check the type of instance before accessing the object.</p>
<p>You can get the track data using <a class="el" href="interface_a_c_r_aes_track_data.html#aaa8a942e5119a6a4e236f7455f31dc99" title="Track data. ">ACRAesTrackData::trackData</a>, <a class="el" href="interface_a_c_r_dukpt_track_data.html#ae285d2765da04ccc26fafa3fcb1a6c25" title="Track 1 data. ">ACRDukptTrackData::track1Data</a> and <a class="el" href="interface_a_c_r_dukpt_track_data.html#ab9ae42e30961faabc90b1719733d934d" title="Track 2 data. ">ACRDukptTrackData::track2Data</a> properties. Note that the track data of <a class="el" href="interface_a_c_r_aes_track_data.html" title="The ACRAesTrackData class represents the track data after swiping a card from the reader using AES mo...">ACRAesTrackData</a> object is encrypted by AES while the track data of <a class="el" href="interface_a_c_r_dukpt_track_data.html" title="The ACRDukptTrackData class represents the track data after swiping a card from the reader using DUKP...">ACRDukptTrackData</a> object is encrypted by Triple DES. You must decrypt it before accessing the original track data.</p>
<p>After decrypting the track data of <a class="el" href="interface_a_c_r_aes_track_data.html" title="The ACRAesTrackData class represents the track data after swiping a card from the reader using AES mo...">ACRAesTrackData</a> object, you can use <a class="el" href="interface_a_c_r_track1_data.html#a872938f5c74393d1f0eec4e7bd19fa68" title="Returns an initialized ACRTrack1Data object from a given buffer of bytes. ">initWithBytes:length: (ACRTrack1Data)</a> and <a class="el" href="interface_a_c_r_track2_data.html#a4c0758ccfbe5fb1c1eb3eee87c34eca1" title="Returns an initialized ACRTrack2Data object from a given buffer of bytes. ">initWithBytes:length: (ACRTrack2Data)</a> methods to decode the track data into fields. For the track data or masked track data of <a class="el" href="interface_a_c_r_dukpt_track_data.html" title="The ACRDukptTrackData class represents the track data after swiping a card from the reader using DUKP...">ACRDukptTrackData</a> object, you can use <a class="el" href="interface_a_c_r_track1_data.html#ab5d450430962bbb8d8f5cc7362d7c177" title="Returns an initialized ACRTrack1Data object from a given string. ">initWithString: (ACRTrack1Data)</a> and <a class="el" href="interface_a_c_r_track2_data.html#af9e7ed59ce64647d3f8ed10c5a6da0f3" title="Returns an initialized ACRTrack2Data object from a given string. ">initWithString: (ACRTrack2Data)</a> methods.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader</div>
<div class="line">    didSendTrackData:(<a class="code" href="interface_a_c_r_track_data.html">ACRTrackData</a> *)trackData {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the track data.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((trackData.track1ErrorCode != <a class="code" href="_a_c_r_track_data_8h.html#ac0a9855e2220eca9fdc19668a501ea45ad34979211a2a5ca7fabdef7a645a132c">ACRTrackErrorSuccess</a>) ||</div>
<div class="line">        (trackData.track2ErrorCode != <a class="code" href="_a_c_r_track_data_8h.html#ac0a9855e2220eca9fdc19668a501ea45ad34979211a2a5ca7fabdef7a645a132c">ACRTrackErrorSuccess</a>)) {</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Show the track error.</span></div>
<div class="line">        ...</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ([trackData isKindOfClass:[<a class="code" href="interface_a_c_r_aes_track_data.html">ACRAesTrackData</a> <span class="keyword">class</span>]]) {</div>
<div class="line"></div>
<div class="line">        ACRAesTrackData *aesTrackData = (ACRAesTrackData *) trackData;</div>
<div class="line"></div>
<div class="line">        ...</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([trackData isKindOfClass:[<a class="code" href="interface_a_c_r_dukpt_track_data.html">ACRDukptTrackData</a> <span class="keyword">class</span>]]) {</div>
<div class="line"></div>
<div class="line">        ACRDukptTrackData *dukptTrackData = (ACRDukptTrackData *) trackData;</div>
<div class="line"></div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="raw"></a>
Receiving the raw data</h2>
<p>If you want to access a raw data of a response, your delegate object should implement <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ac904d7bec416625cb5d40545c1ad0374" title="Tells the delegate that the reader sent the raw data. ">reader:didSendRawData:length: (ACRAudioJackReaderDelegate-p)</a> method. Note that the raw data is not verified by CRC16 checksum and you can call <a class="el" href="interface_a_c_r_audio_jack_reader.html#a7d45a593abd062669b02f006d88f9aa2" title="Verifies the data using CRC16 checksum. ">verifyData:length: (ACRAudioJackReader)</a> method to verify it.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader</div>
<div class="line">    didSendRawData:(<span class="keyword">const</span> uint8_t *)rawData length:(NSUInteger)length {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the raw data.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="icc"></a>
Working with the ICC</h2>
<p>If your reader came with the ICC interface, you can operate the card using the following methods:</p>
<ul>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a832c9c34cdbe8089ce897e7e5e73b67b" title="Performs the power action on the card. ">powerCardWithAction:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#ad6c40b0a93fb997e2e0c29a1ebeb0675" title="Sets the protocol. ">setProtocol:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a96ec092a1ef1d5446252584322751c61" title="Transmits the APDU. ">transmitApdu:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a42481668373a11bb7b54bfcba7597716" title="Transmits the APDU. ">transmitApdu:length:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a64fc9d1188485d35ac47b51c43cab36d" title="Transmits the control command. ">transmitControlCommand:controlCode:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a66f173875e6e145d2cdd40f483bf23f4" title="Transmits the control command. ">transmitControlCommand:length:controlCode:slotNum:timeout:error: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#ae4be584d785b7d9d353c461be8fd04c0" title="Gets the ATR string. ">getAtrWithSlotNumber: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#a5f18a747c0cadc4ff410629f6b298045" title="Gets the card state. ">getStateWithSlotNumber: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#ab1ba6016abf86ed7f39e973e8c175e21" title="Gets the active protocol. ">getProtocolWithSlotNumber: (ACRAudioJackReader)</a></li>
</ul>
<p>Before transmitting the APDU, you need to reset the card using <a class="el" href="interface_a_c_r_audio_jack_reader.html#a832c9c34cdbe8089ce897e7e5e73b67b" title="Performs the power action on the card. ">powerCardWithAction:slotNum:timeout:error: (ACRAudioJackReader)</a> method. The ATR string will be returned if the card is operated normally. Otherwise, it will return the error code.</p>
<p>After resetting the card, the card state is changed to <a class="el" href="_a_c_r_audio_jack_reader_8h.html#a138d5f1c9c3203dbbec871c6c04a692caf4696460d51c1a946d10b6f9ecccbf4f" title="The card has been reset and is awaiting PTS negotiation. ">ACRCardNegotiable</a> or <a class="el" href="_a_c_r_audio_jack_reader_8h.html#a138d5f1c9c3203dbbec871c6c04a692ca6b9e3eb532d6a07206e2363024591e61" title="The card has been reset and specific communication protocols have been established. ">ACRCardSpecific</a>. You cannot transmit the APDU if the card state is not equal to <a class="el" href="_a_c_r_audio_jack_reader_8h.html#a138d5f1c9c3203dbbec871c6c04a692ca6b9e3eb532d6a07206e2363024591e61" title="The card has been reset and specific communication protocols have been established. ">ACRCardSpecific</a>. To select the protocol, invoke <a class="el" href="interface_a_c_r_audio_jack_reader.html#ad6c40b0a93fb997e2e0c29a1ebeb0675" title="Sets the protocol. ">setProtocol:slotNum:timeout:error: (ACRAudioJackReader)</a> method with the preferred protocols.</p>
<p>After selecting the protocol, you can transmit the command APDU using <a class="el" href="interface_a_c_r_audio_jack_reader.html#a96ec092a1ef1d5446252584322751c61" title="Transmits the APDU. ">transmitApdu:slotNum:timeout:error: (ACRAudioJackReader)</a> or <a class="el" href="interface_a_c_r_audio_jack_reader.html#a42481668373a11bb7b54bfcba7597716" title="Transmits the APDU. ">transmitApdu:length:slotNum:timeout:error: (ACRAudioJackReader)</a> method.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">NSUInteger slotNum = 0;</div>
<div class="line"><a class="code" href="_a_c_r_audio_jack_reader_8h.html#a9e37fa64eb0921b94a55ee835dbba932">ACRCardPowerAction</a> powerAction = <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a9e37fa64eb0921b94a55ee835dbba932ab341c0e34dcb8345abc9204c14281075">ACRCardWarmReset</a>;</div>
<div class="line">NSTimeInterval timeout = 10;    <span class="comment">// 10 seconds.</span></div>
<div class="line">NSData *atr = nil;</div>
<div class="line"><a class="code" href="_a_c_r_audio_jack_reader_8h.html#ab123a0b91b1899b392e337cbb2e8d767">ACRCardProtocol</a> protocols = <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2349b02be5fb818661bea64898cfc964">ACRProtocolT0</a> | <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8759ead70ea94498648f584d5d98629b">ACRProtocolT1</a>;</div>
<div class="line"><a class="code" href="_a_c_r_audio_jack_reader_8h.html#ab123a0b91b1899b392e337cbb2e8d767">ACRCardProtocol</a> activeProtocol = 0;</div>
<div class="line">uint8_t commandApdu[] = { 0x00, 0x84, 0x00, 0x00, 0x08 };</div>
<div class="line">NSData *responseApdu = nil;</div>
<div class="line">NSError *error = nil;</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Reset the card.</span></div>
<div class="line">atr = [_reader powerCardWithAction:powerAction slotNum:slotNum timeout:timeout</div>
<div class="line">    error:&amp;error];</div>
<div class="line"><span class="keywordflow">if</span> (atr != nil) {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set the protocol.</span></div>
<div class="line">    activeProtocol = [_reader setProtocol:protocols slotNum:slotNum</div>
<div class="line">        timeout:timeout error:&amp;error];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Transmit the APDU.</span></div>
<div class="line">    responseApdu = [_reader transmitApdu:commandApdu length:<span class="keyword">sizeof</span>(commandApdu)</div>
<div class="line">        slotNum:slotNum timeout:timeout error:&amp;error];</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><p>You can transmit the control command to the reader using <a class="el" href="interface_a_c_r_audio_jack_reader.html#a64fc9d1188485d35ac47b51c43cab36d" title="Transmits the control command. ">transmitControlCommand:controlCode:slotNum:timeout:error: (ACRAudioJackReader)</a> or <a class="el" href="interface_a_c_r_audio_jack_reader.html#a66f173875e6e145d2cdd40f483bf23f4" title="Transmits the control command. ">transmitControlCommand:length:controlCode:slotNum:timeout:error: (ACRAudioJackReader)</a> method if the reader supports a set of escape commands.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">NSUInteger controlCode = <a class="code" href="_a_c_r_audio_jack_reader_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a3be3204ef1e9b7d951fd2e160ee7e74d">ACRIoctlCcidEscape</a>;</div>
<div class="line">uint8_t controlCommand[] = { 0xE0, 0x00, 0x00, 0x18, 0x00 };</div>
<div class="line">NSData *controlResponse = nil;</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Transmit the control command.</span></div>
<div class="line">controlResponse = [_reader transmitControlCommand:controlCommand</div>
<div class="line">    controlCode:controlCode slotNum:slotNum timeout:timeout error:&amp;error];</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="picc"></a>
Working with the PICC</h2>
<p>If your reader came with the PICC interface, you can operate the card using the following methods:</p>
<ul>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#ae3a13bb6b220d2162fb42c19bf47f177" title="Powers on the PICC. ">piccPowerOnWithTimeout:cardType: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#ae0b09dd64cdf333aa6428135d3938053" title="Transmits the command APDU to the PICC. ">piccTransmitWithTimeout:commandApdu:length: (ACRAudioJackReader)</a></li>
<li><a class="el" href="interface_a_c_r_audio_jack_reader.html#af7f22a208e19968ae17beb1c9e39652a" title="Powers off the PICC. ">piccPowerOff (ACRAudioJackReader)</a></li>
</ul>
<p>Before transmitting the APDU, you need to power on the card using <a class="el" href="interface_a_c_r_audio_jack_reader.html#ae3a13bb6b220d2162fb42c19bf47f177" title="Powers on the PICC. ">piccPowerOnWithTimeout:cardType: (ACRAudioJackReader)</a> method. If your delegate object implements ACRAudioJackReaderDelegate::reader:didSendPiccAtr:length method, it will receive the ATR string from the card.</p>
<p>To transmit the APDU, you can use <a class="el" href="interface_a_c_r_audio_jack_reader.html#ae0b09dd64cdf333aa6428135d3938053" title="Transmits the command APDU to the PICC. ">piccTransmitWithTimeout:commandApdu:length: (ACRAudioJackReader)</a> method. If your delegate object implements ACRAudioJackReaderDelegate::reader:didSendPiccResponseApdu:length method, it will receive the response APDU from the card.</p>
<p>After using the card, you can pwoer off the card using <a class="el" href="interface_a_c_r_audio_jack_reader.html#af7f22a208e19968ae17beb1c9e39652a" title="Powers off the PICC. ">piccPowerOff (ACRAudioJackReader)</a> method. If your delegate object implements <a class="el" href="protocol_a_c_r_audio_jack_reader_delegate-p.html#ab8fe480d3dc5cf02861e979a9c3aed6e" title="Tells the delegate that the reader notified the result. ">reader:didNotifyResult: (ACRAudioJackReaderDelegate-p)</a> method, it will receive a notification after the operation is completed.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">NSUInteger timeout = 1; <span class="comment">// 1 second.</span></div>
<div class="line">NSUInteger cardType = <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a5458be4244c67d39b15dfe94eea90faeac95e5f6c3db803bacfaff56897611d9c">ACRPiccCardTypeIso14443TypeA</a> |</div>
<div class="line">    <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a5458be4244c67d39b15dfe94eea90faeaa1c4abb2d8d699bfbf3eb059100baa97">ACRPiccCardTypeIso14443TypeB</a> |</div>
<div class="line">    <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a5458be4244c67d39b15dfe94eea90faeaa0e156ed822dccd1e6052204d495fef2">ACRPiccCardTypeFelica212kbps</a> |</div>
<div class="line">    <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a5458be4244c67d39b15dfe94eea90faea75a731d6073c10ef01553d2593875f54">ACRPiccCardTypeFelica424kbps</a> |</div>
<div class="line">    <a class="code" href="_a_c_r_audio_jack_reader_8h.html#a5458be4244c67d39b15dfe94eea90faeacc0eae5ceacf2a0fde5c17acb9bbc729">ACRPiccCardTypeAutoRats</a>;</div>
<div class="line">uint8_t commandApdu[] = { 0x00, 0x84, 0x00, 0x00, 0x08 };</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Power on the PICC.</span></div>
<div class="line">[_reader piccPowerOnWithTimeout:timeout cardType:cardType];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Transmit the APDU.</span></div>
<div class="line">[_reader piccTransmitWithTimeout:timeout commandApdu:commandApdu</div>
<div class="line">    length:<span class="keyword">sizeof</span>(commandApdu)];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Power off the PICC.</span></div>
<div class="line">[_reader piccPowerOff];</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">#pragma mark - Audio Jack Reader</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader didSendPiccAtr:(<span class="keyword">const</span> uint8_t *)atr</div>
<div class="line">    length:(NSUInteger)length {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the ATR.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader</div>
<div class="line">    didSendPiccResponseApdu:(<span class="keyword">const</span> uint8_t *)responseApdu</div>
<div class="line">    length:(NSUInteger)length {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the response APDU.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">- (void)reader:(<a class="code" href="interface_a_c_r_audio_jack_reader.html">ACRAudioJackReader</a> *)reader didNotifyResult:(<a class="code" href="interface_a_c_r_result.html">ACRResult</a> *)result {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: Add code here to process the notification.</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 4 2014 13:56:07 for ACS Audio Jack iOS Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
